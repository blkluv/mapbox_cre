<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ATLWarehouse Grid</title>

<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">

<style>
body { 
    margin:0; 
    padding:0; 
    background:#0a0a0a; 
    font-family: Arial, sans-serif; 
    overflow: hidden;
}

#map { 
    position: absolute; 
    top: 120px; /* Increased to make room for header + filter bar */
    bottom: 0; 
    width: 100%; 
}

/* Fixed Header */
#header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 60px;
    background: linear-gradient(90deg, #00ffea, #ff00ff);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 30px;
    z-index: 1000;
    font-weight: bold;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
}

#header a, .header-link {
    color: #000;
    text-decoration: none;
    background: #fff;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
}

#header a:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(255,255,255,0.5);
}

#counter {
    color: black;
    background: white;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
}

/* Filter Bar - Fixed below header */
#filter-bar {
    position: fixed;
    top: 70px; /* 60px header + 10px gap */
    left: 10px;
    right: 10px;
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding: 5px 0 15px 0;
    z-index: 999;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; /* Hide scrollbar Firefox */
}

#filter-bar::-webkit-scrollbar {
    display: none; /* Hide scrollbar Chrome/Safari */
}

.filter-btn {
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(10px);
    border: 2px solid #ff00ff;
    border-radius: 30px;
    padding: 10px 24px;
    font-size: 14px;
    font-weight: bold;
    color: #ff00ff;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.2s;
    box-shadow: 0 0 15px rgba(255,0,255,0.3);
}

.filter-btn.active {
    background: #ff00ff;
    color: black;
    border-color: #00ffea;
    box-shadow: 0 0 20px #ff00ff;
}

/* Popup styles */
.mapboxgl-popup-content {
    background: #111 !important;
    color: #fff;
    border-radius: 16px !important;
    padding: 15px !important;
    border: 1px solid #00ffea;
}

.mapboxgl-popup-content h3 {
    color: #00ffea;
    margin: 0 0 10px 0;
    font-size: 16px;
}

.mapboxgl-popup-close-button {
    color: #fff !important;
    font-size: 16px !important;
    padding: 5px 10px !important;
}

/* Bottom Sheet */
#sheet {
    position: fixed;
    left: 10px;
    right: 10px;
    bottom: 10px;
    background: rgba(10,10,10,0.98);
    backdrop-filter: blur(20px);
    border-radius: 25px;
    border: 2px solid #00ffea;
    transform: translateY(120%);
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    z-index: 2000;
    padding: 25px;
    box-shadow: 0 0 30px rgba(0,255,234,0.3);
}

#sheet.open { 
    transform: translateY(0); 
}

#close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    color: #888;
    font-size: 24px;
    cursor: pointer;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
}

#close-btn:hover {
    background: rgba(255,255,255,0.1);
    color: white;
}

.stat-box {
    background: rgba(255,255,255,0.05);
    padding: 15px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.1);
}

.stat-box div:first-child {
    font-size: 11px;
    margin-bottom: 5px;
}

.stat-box div:last-child {
    font-size: 24px;
    font-weight: 900;
}

/* Telegram Widget */
#telegram-widget {
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: #0088cc;
    color: white;
    padding: 12px 25px;
    border-radius: 40px;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    z-index: 1500;
    font-weight: bold;
    box-shadow: 0 0 25px rgba(0,136,204,0.6);
    border: 1px solid rgba(255,255,255,0.2);
}

#telegram-widget:hover {
    transform: scale(1.02);
    background: #0077b5;
}

/* Loading indicator */
.loading {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #00ffea;
    font-size: 18px;
    text-shadow: 0 0 10px #00ffea;
}
</style>
</head>
<body>

<div id="header">
<a href="#" onclick="openOPS()">‚öôÔ∏è OPS</a>
<a href="#" onclick="openHome()">üè† HOME</a>
<a href="#" onclick="openTikTok()">üéµ TIKTOK</a>
<a href="#" onclick="openTV()">üì∫ TV</a>
<span id="counter">SCANNING...</span>
</div>

<div id="filter-bar">
<div class="filter-btn active" onclick="filterFacilities('all')">ALL FACILITIES</div>
<div class="filter-btn" onclick="filterFacilities('vacant')">üü¢ VACANT NOW</div>
<div class="filter-btn" onclick="filterFacilities('verified')">‚úÖ VERIFIED</div>
<div class="filter-btn" onclick="filterFacilities('ugc')">üé¨ HAS UGC</div>
</div>

<div id="map"></div>

<div id="telegram-widget" onclick="openTelegram()">
<img src="https://telegram.org/img/website_icon.svg" width="24" height="24" style="filter: invert(1);">
<span>@atlwarehouse ‚Ä¢ <span id="online-count">2.3k</span> online</span>
</div>

<div id="sheet">
<button id="close-btn" onclick="closeSheet()">√ó</button>
<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
<div>
<h2 id="s-name" style="margin:0; color:#00ffea; font-size:24px;">WAREHOUSE</h2>
<p id="s-loc" style="margin:5px 0; color:#888;">Atlanta Industrial District</p>
</div>
<div style="font-size:48px; font-weight:900; color:#00ffea; text-shadow:0 0 15px #00ffea;" id="s-grade">A+</div>
</div>

<div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:20px;">
<div class="stat-box">
<div style="color:#00ffea;">POWER CAPACITY</div>
<div id="s-power">4.5 MW</div>
</div>
<div class="stat-box">
<div style="color:#ff00ff;">DRAYAGE ZONE</div>
<div id="s-zone">INNER RING</div>
</div>
</div>

<div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
<button onclick="pinToTikTok()" style="padding:16px; border-radius:12px; border:none; background:linear-gradient(45deg, #ff00ff, #00ffea); color:black; font-weight:900; font-size:16px; cursor:pointer;">
üìπ PIN YOUR TIKTOK
</button>
<button onclick="joinTelegram()" style="padding:16px; border-radius:12px; border:2px solid #0088cc; background:transparent; color:#0088cc; font-weight:900; font-size:16px; cursor:pointer;">
üí¨ DISCUSS
</button>
</div>
</div>

<script>
// REPLACE WITH YOUR MAPBOX TOKEN
mapboxgl.accessToken = "YOUR_MAPBOX_TOKEN";

const map = new mapboxgl.Map({
container: "map",
style: "mapbox://styles/mapbox/dark-v11",
center: [-84.39, 33.77],
zoom: 10
});

map.addControl(new mapboxgl.NavigationControl());

// Store markers
let allMarkers = [];
let currentFacility = null;

// Load warehouses
async function loadWarehouses() {
try {
const query = `
[out:json][timeout:25];
(
  node["building"="warehouse"](33.45,-84.70,34.05,-84.10);
  way["building"="warehouse"](33.45,-84.70,34.05,-84.10);
);
out center;
`;

const response = await fetch("https://overpass-api.de/api/interpreter", {
method: "POST",
body: query
});

const data = await response.json();
document.getElementById('counter').innerText = `üìä ${data.elements.length} FACILITIES`;

data.elements.forEach((el, index) => {
let coords;

if (el.type === "node") {
coords = [el.lon, el.lat];
} else if (el.type === "way" && el.center) {
coords = [el.center.lon, el.center.lat];
} else return;

const name = el.tags?.name || `Warehouse ${index + 1}`;

// Demo data
const power = (Math.random() * 5 + 1).toFixed(1);
const grade = ['A+', 'A', 'B+', 'A-'][Math.floor(Math.random() * 4)];
const utilization = Math.floor(Math.random() * 100);
const hasUGC = Math.random() > 0.6;
const verified = Math.random() > 0.7;

// Create popup HTML
const popupHTML = `
<div style="max-width:280px;">
<h3>${name}</h3>
<p>üì¶ Utilization: ${utilization}%</p>
<p>‚ö° Power: ${power} MW</p>
<p>üèÜ Grade: ${grade}</p>
${hasUGC ? '<p style="color:#ff00ff;">üé¨ Has TikTok UGC</p>' : ''}
<hr style="border-color:#333; margin:10px 0;">
<button onclick="window.pinFromPopup('${name}')" style="
width:100%;
padding:10px;
background:#ff00ff;
color:white;
border:none;
border-radius:8px;
font-weight:bold;
cursor:pointer;
font-size:14px;">
üìπ Pin Your TikTok
</button>
</div>
`;

// Create marker
const marker = new mapboxgl.Marker({ color: hasUGC ? "#ff00ff" : "#00ffea" })
.setLngLat(coords)
.setPopup(new mapboxgl.Popup({ maxWidth: "300px" }).setHTML(popupHTML))
.addTo(map);

// Store data
marker._data = {
name: name,
power: power,
grade: grade,
utilization: utilization,
hasUGC: hasUGC,
verified: verified
};

// Click handler for bottom sheet
marker.getElement().addEventListener('click', () => {
currentFacility = marker._data;
openSheet(marker._data);
});

allMarkers.push(marker);
});

} catch (err) {
console.error("Error:", err);
document.getElementById('counter').innerText = "‚ö†Ô∏è OFFLINE";
}
}

// Filter facilities
function filterFacilities(filter) {
document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
event.target.classList.add('active');

allMarkers.forEach(marker => {
if (!marker._data) return;

switch(filter) {
case 'all':
marker.getElement().style.display = 'block';
break;
case 'vacant':
marker.getElement().style.display = marker._data.utilization < 30 ? 'block' : 'none';
break;
case 'verified':
marker.getElement().style.display = marker._data.verified ? 'block' : 'none';
break;
case 'ugc':
marker.getElement().style.display = marker._data.hasUGC ? 'block' : 'none';
break;
}
});
}

// Sheet functions
function openSheet(data) {
document.getElementById('s-name').innerText = data.name;
document.getElementById('s-grade').innerText = data.grade;
document.getElementById('s-power').innerText = data.power + " MW";
document.getElementById('s-zone').innerText = data.utilization > 70 ? "HIGH TRAFFIC" : "NORMAL";
document.getElementById('sheet').classList.add('open');
}

function closeSheet() {
document.getElementById('sheet').classList.remove('open');
}

// TikTok functions
function openTikTok() {
window.open('https://tiktok.com/@atlwarehouse', '_blank');
}

function pinToTikTok() {
if (!currentFacility) {
alert('Please click a warehouse first');
return;
}
window.open('https://tiktok.com/@atlwarehouse', '_blank');
alert('üì± After posting, DM @atlwarehouse on TikTok to get pinned!');
}

window.pinFromPopup = function(name) {
currentFacility = { name: name };
pinToTikTok();
}

// Telegram functions
function openTelegram() {
window.open('https://t.me/atlwarehouse', '_blank');
}

function joinTelegram() {
openTelegram();
}

// Header functions
function openOPS() {
window.open('https://ops.ATLwarehouse.com', '_blank');
}

function openHome() {
window.open('https://ATLwarehouse.com', '_blank');
}

function openTV() {
window.open('https://TV.atlwarehouse.com', '_blank');
}

// Update online count randomly
setInterval(() => {
const online = Math.floor(Math.random() * 2000) + 1500;
document.getElementById('online-count').innerText = (online / 1000).toFixed(1) + 'k';
}, 30000);

// Load warehouses when map loads
map.on('load', loadWarehouses);
</script>

</body>
</html>
