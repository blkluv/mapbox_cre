<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ATL WAREHOUSE | COMMAND CENTER</title>

  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet"/>

  <style>
    :root {
      --aqua: #00f2ff;
      --pink: #ff007f;
      --neon-green: #39ff14;
      --glass: rgba(15, 15, 15, 0.85);
      --border: rgba(255, 255, 255, 0.1);
    }

    body { margin:0; padding:0; background:#050505; font-family: 'Inter', sans-serif; color: white; overflow: hidden; }
    #map { position:absolute; top:0; bottom:0; width:100%; filter: saturate(1.2) brightness(0.8); }

    /* Neon Overlay Effect */
    #map::after {
      content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      box-shadow: inset 0 0 150px rgba(0,0,0,0.5); pointer-events: none; z-index: 2;
    }

    /* TikTok Friendly Header */
    #header {
      position: fixed; top: 20px; left: 20px; right: 20px;
      display: flex; justify-content: space-between; align-items: center;
      z-index: 1000;
    }

    .brand {
      background: var(--glass); backdrop-filter: blur(10px);
      padding: 12px 20px; border-radius: 40px; border: 1px solid var(--border);
      font-weight: 900; letter-spacing: 2px; font-size: 14px; color: var(--aqua);
      box-shadow: 0 0 20px rgba(0, 242, 255, 0.2);
    }

    .stats-pill {
      background: var(--pink); color: white; padding: 8px 16px; 
      border-radius: 40px; font-weight: 900; font-size: 12px;
      animation: pulse-red 2s infinite;
    }

    /* Floating Action Dock */
    #dock {
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
      display: flex; gap: 15px; z-index: 1000; padding: 10px;
      background: var(--glass); backdrop-filter: blur(20px);
      border-radius: 100px; border: 1px solid var(--border);
    }

    .dock-btn {
      width: 50px; height: 50px; border-radius: 50%; border: none;
      background: rgba(255,255,255,0.05); color: white; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .dock-btn:hover { transform: scale(1.2); background: var(--aqua); color: black; }

    /* Bottom Sheet - Mobile First */
    #sheet {
      position: fixed; left: 0; right: 0; bottom: 0; height: 65vh;
      background: #0a0a0a; border-radius: 30px 30px 0 0;
      transform: translateY(110%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 2000; padding: 30px; border-top: 1px solid var(--aqua);
    }

    #sheet.open { transform: translateY(0); }

    .grade-badge {
      font-size: 48px; font-weight: 900; color: var(--aqua);
      text-shadow: 0 0 20px rgba(0,242,255,0.5);
    }

    @keyframes pulse-red {
      0% { box-shadow: 0 0 0 0 rgba(255, 0, 127, 0.7); }
      70% { box-shadow: 0 0 0 15px rgba(255, 0, 127, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 0, 127, 0); }
    }

    /* Scanning Line for TikTok Video */
    .scanline {
      width: 100%; height: 2px; background: var(--aqua);
      position: fixed; top: 0; left: 0; z-index: 3000;
      opacity: 0.3; pointer-events: none;
      animation: scan 4s linear infinite;
    }

    @keyframes scan {
      0% { top: 0; }
      100% { top: 100%; }
    }
  </style>
</head>
<body>

  <div class="scanline"></div>

  <div id="header">
    <div class="brand">ATL WAREHOUSE // OPS</div>
    <div class="stats-pill">LIVE NETWORK: 482 UNITS</div>
  </div>

  <div id="map"></div>

  <div id="dock">
    <button class="dock-btn" title="Heatmap">üî•</button>
    <button class="dock-btn" title="Labor">üë∑</button>
    <button class="dock-btn" style="background: var(--aqua); color:black;" title="Add Warehouse">+</button>
    <button class="dock-btn" title="Verification">‚úÖ</button>
    <button class="dock-btn" title="Satellite">üõ∞Ô∏è</button>
  </div>

  <div id="sheet">
    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
        <div>
            <h1 id="sheet-title" style="margin:0; font-size:24px; color:var(--aqua);">CENTRAL HUB A1</h1>
            <p id="sheet-location" style="color:#888;">South Fulton, Atlanta, GA</p>
        </div>
        <div class="grade-badge" id="sheet-grade">A</div>
    </div>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-top:20px;">
        <div style="background:rgba(255,255,255,0.03); padding:15px; border-radius:15px;">
            <div style="color:var(--aqua); font-size:10px; font-weight:900;">POWER CAPACITY</div>
            <div style="font-size:20px; font-weight:900;" id="sheet-power">4.5 MW</div>
        </div>
        <div style="background:rgba(255,255,255,0.03); padding:15px; border-radius:15px;">
            <div style="color:var(--pink); font-size:10px; font-weight:900;">DRAYAGE ZONE</div>
            <div style="font-size:20px; font-weight:900;" id="sheet-drayage">INNER</div>
        </div>
    </div>

    <div id="viral-stat" style="margin-top:20px; border-left: 4px solid var(--neon-green); padding-left:15px;">
        <p style="color:var(--neon-green); font-weight:900; margin:0;">3PL EFFICIENCY MATCH</p>
        <h2 style="margin:5px 0;">98.4%</h2>
    </div>

    <button onclick="closeSheet()" style="width:100%; margin-top:30px; padding:18px; border-radius:15px; border:none; background:var(--aqua); font-weight:900; font-size:16px; cursor:pointer;">BOOK SITE VISIT</button>
  </div>

<script>
  let map;

  async function initMap() {
    const config = await fetch('/api/config').then(r => r.json());
    mapboxgl.accessToken = config.mapboxToken;

    map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/blkluv/cmm259s0u00eg01s322oh9vfd', 
      center: [-84.3880, 33.7490],
      zoom: 10.2,
      pitch: 55,
      antialias: true
    });

    map.on('load', async () => {
      const facilities = await fetch('/api/facilities').then(r => r.json());

      map.addSource('warehouses', {
        type: 'geojson',
        data: facilities
      });

      // Viral Layer: The Pulse effect for Class A
      map.addLayer({
        id: 'warehouse-glow',
        type: 'circle',
        source: 'warehouses',
        paint: {
          'circle-radius': 15,
          'circle-color': '#00f2ff',
          'circle-opacity': 0.2,
          'circle-blur': 1
        }
      });

      map.addLayer({
        id: 'warehouse-points',
        type: 'circle',
        source: 'warehouses',
        paint: {
          'circle-radius': ['interpolate', ['linear'], ['zoom'], 10, 6, 15, 12],
          'circle-color': [
            'case',
            ['==', ['get', 'grade'], 'A'], '#00f2ff',
            ['==', ['get', 'grade'], 'B+'], '#ff007f',
            '#ffffff'
          ],
          'circle-stroke-width': 2,
          'circle-stroke-color': '#000'
        }
      });

      map.on('click', 'warehouse-points', (e) => {
        const props = e.features[0].properties;
        openSheet(props);
      });
      
      // Add cursor changes
      map.on('mouseenter', 'warehouse-points', () => map.getCanvas().style.cursor = 'pointer');
      map.on('mouseleave', 'warehouse-points', () => map.getCanvas().style.cursor = '');
    });
  }

  function openSheet(p) {
    document.getElementById('sheet-title').innerText = p.name;
    document.getElementById('sheet-power').innerText = p.power_mw + ' MW';
    document.getElementById('sheet-grade').innerText = p.grade || 'C';
    document.getElementById('sheet-drayage').innerText = p.drayage_zone === 'Inner Ring (Savannah/ATL)' ? 'INNER' : 'OUTER';
    document.getElementById('sheet').classList.add('open');
  }

  function closeSheet() {
    document.getElementById('sheet').classList.remove('open');
  }

  initMap();
</script>
</body>
</html>
