<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ATLWarehouse Grid</title>

<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">

<style>
body { margin:0; padding:0; background:#0a0a0a; font-family:Arial; }
#map { position:absolute; top:60px; bottom:0; width:100%; }

#header {
position:fixed;
top:0;
width:100%;
height:60px;
background:linear-gradient(90deg,#00ffea,#ff00ff);
display:flex;
align-items:center;
justify-content:center;
gap:30px;
z-index:1000;
font-weight:bold;
}

#header a, .header-link {
color:#000;
text-decoration:none;
background:#fff;
padding:6px 12px;
border-radius:6px;
font-size:14px;
cursor:pointer;
}

#counter {
color: black;
background: white;
padding: 6px 12px;
border-radius: 6px;
font-size: 14px;
font-weight: bold;
}

#filter-bar {
position: fixed;
top: 70px;
left: 10px;
right: 10px;
display: flex;
gap: 10px;
overflow-x: auto;
padding: 10px;
z-index: 999;
}

.filter-btn {
background: rgba(0,0,0,0.8);
backdrop-filter: blur(5px);
border: 1px solid #ff00ff;
border-radius: 25px;
padding: 8px 20px;
font-size: 13px;
color: #ff00ff;
cursor: pointer;
white-space: nowrap;
}

.filter-btn.active {
background: #ff00ff;
color: black;
}

#sheet {
position: fixed;
left: 10px;
right: 10px;
bottom: 10px;
background: rgba(10,10,10,0.95);
backdrop-filter: blur(20px);
border-radius: 25px;
border: 1px solid #00ffea;
transform: translateY(120%);
transition: transform 0.4s;
z-index: 2000;
padding: 25px;
}

#sheet.open { transform: translateY(0); }

#close-btn {
position: absolute;
top: 15px;
right: 15px;
background: none;
border: none;
color: white;
font-size: 24px;
cursor: pointer;
}

.stat-box {
background: rgba(255,255,255,0.05);
padding: 15px;
border-radius: 12px;
border: 1px solid rgba(255,255,255,0.1);
}

.mapboxgl-popup-content {
background:#111 !important;
color:#fff;
border-radius:12px;
}

.mapboxgl-popup-content h3 {
color:#00ffea;
margin-bottom:8px;
}

.ugc-thumb {
width: 50px;
height: 50px;
border-radius: 10px;
border: 2px solid #ff00ff;
cursor: pointer;
margin: 5px;
object-fit: cover;
}

#telegram-widget {
position: fixed;
bottom: 20px;
right: 20px;
background: #0088cc;
color: white;
padding: 12px 20px;
border-radius: 30px;
display: flex;
align-items: center;
gap: 10px;
cursor: pointer;
z-index: 2000;
font-weight: bold;
box-shadow: 0 0 20px rgba(0,136,204,0.5);
}

.tiktok-badge {
background: #ff00ff;
color: white;
padding: 4px 8px;
border-radius: 12px;
font-size: 10px;
margin-left: 5px;
}
</style>
</head>
<body>

<div id="header">
<a href="https://ops.ATLwarehouse.com">âš™ï¸ OPS</a>
<a href="https://ATLwarehouse.com">ğŸ  HOME</a>
<a href="#" onclick="openTikTokAR()" class="header-link">ğŸµ AR EFFECT</a>
<a href="#" onclick="openTelegram()" class="header-link">ğŸ“± TELEGRAM</a>
<span id="counter">SCANNING...</span>
</div>

<div id="filter-bar">
<div class="filter-btn active" onclick="filterFacilities('all')">ALL FACILITIES</div>
<div class="filter-btn" onclick="filterFacilities('vacant')">VACANT NOW</div>
<div class="filter-btn" onclick="filterFacilities('verified')">VERIFIED</div>
<div class="filter-btn" onclick="filterFacilities('ugc')">HAS UGC</div>
</div>

<div id="map"></div>

<!-- Telegram Widget -->
<div id="telegram-widget" onclick="openTelegram()">
<img src="https://telegram.org/img/website_icon.svg" width="24" height="24" style="filter: invert(1);">
<span>@atlwarehouse â€¢ 2.3k online</span>
</div>

<!-- Bottom Sheet -->
<div id="sheet">
<button id="close-btn" onclick="closeSheet()">Ã—</button>
<div style="display:flex; justify-content:space-between; align-items:start;">
<div>
<h2 id="s-name" style="margin:0; color:#00ffea;">WAREHOUSE</h2>
<p id="s-loc" style="margin:5px 0; color:#888;">Atlanta Industrial District</p>
</div>
<div style="font-size:40px; font-weight:900; color:#00ffea;" id="s-grade">A</div>
</div>

<!-- UGC Preview Section -->
<div id="ugc-preview" style="margin:15px 0; display:none;">
<div style="display:flex; gap:10px; overflow-x:auto; padding:5px;">
<div class="ugc-thumb" onclick="playUGC('video1')" style="background:#333; display:flex; align-items:center; justify-content:center;">ğŸ¥</div>
<div class="ugc-thumb" onclick="playUGC('video2')" style="background:#333; display:flex; align-items:center; justify-content:center;">ğŸ¥</div>
<div class="ugc-thumb" onclick="playUGC('video3')" style="background:#333; display:flex; align-items:center; justify-content:center;">ğŸ¥</div>
</div>
<p style="color:#888; font-size:12px; margin-top:5px;">ğŸ¬ TikTok UGC â€¢ Verified by community</p>
</div>

<div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-top:10px;">
<div class="stat-box">
<div style="font-size:10px; color:#00ffea;">POWER CAPACITY</div>
<div style="font-size:20px; font-weight:900;" id="s-power">4.5 MW</div>
</div>
<div class="stat-box">
<div style="font-size:10px; color:#ff00ff;">DRAYAGE ZONE</div>
<div style="font-size:20px; font-weight:900;" id="s-zone">INNER RING</div>
</div>
</div>

<!-- Verification Status -->
<div style="display:flex; gap:10px; margin:15px 0;">
<span id="verified-badge" style="background:#00ff88; color:black; padding:4px 12px; border-radius:20px; font-size:12px; display:none;">âœ… VERIFIED</span>
<span id="ugc-count" style="background:#ff00ff; color:white; padding:4px 12px; border-radius:20px; font-size:12px;">ğŸ“± 0 UGC clips</span>
</div>

<!-- Action Buttons -->
<div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
<button onclick="pinYourVideo()" style="padding:15px; border-radius:12px; border:none; background:#ff00ff; color:white; font-weight:900; cursor:pointer;">
ğŸ“¹ PIN YOUR TIKTOK
</button>
<button onclick="joinTelegramDiscussion()" style="padding:15px; border-radius:12px; border:1px solid #0088cc; background:transparent; color:#0088cc; font-weight:900; cursor:pointer;">
ğŸ’¬ DISCUSS
</button>
</div>
</div>

<script>
// IMPORTANT: Replace with your actual token from Mapbox
// For production, use environment variables via Vercel
mapboxgl.accessToken = "YOUR_MAPBOX_TOKEN"; // Get from https://account.mapbox.com/

const map = new mapboxgl.Map({
container:"map",
style:"mapbox://styles/mapbox/dark-v11",
center:[-84.39,33.77],
zoom:10
});

map.addControl(new mapboxgl.NavigationControl());

// Store all markers
let allMarkers = [];
let currentFacility = null;

// TikTok AR Effect Links - Add your actual effect links here
const TIKTOK_EFFECTS = {
    vacancyScan: "tiktok://effect/123456789?refer=atlwarehouse", // Replace with your effect ID
    utilization: "https://tiktok.com/@atlwarehouse/effect/123456789",
    drayage: "https://tiktok.com/@atlwarehouse/effect/123456790",
    upload: "https://tiktok.com/@atlwarehouse?effect=1"
};

// Telegram Links
const TELEGRAM_LINKS = {
    group: "https://t.me/atlwarehouse",
    bot: "https://t.me/atlwarehouse_bot",
    share: "https://t.me/share/url?url="
};

// UGC Database - In production, this would come from your API
const ugcDatabase = {
    "warehouse-1": [
        { id: "ugc1", user: "@driver_tom", views: "12.5K", video: "tiktok.com/@atlwarehouse/video/1" },
        { id: "ugc2", user: "@logistics_pro", views: "8.2K", video: "tiktok.com/@atlwarehouse/video/2" }
    ],
    "warehouse-2": [
        { id: "ugc3", user: "@warehouse_ops", views: "5.1K", video: "tiktok.com/@atlwarehouse/video/3" }
    ]
};

async function loadWarehouses() {
const query = `
[out:json][timeout:25];
(
  node["building"="warehouse"](33.45,-84.70,34.05,-84.10);
  way["building"="warehouse"](33.45,-84.70,34.05,-84.10);
);
out center;
`;

try {
const response = await fetch("https://overpass-api.de/api/interpreter",{
method:"POST",
body:query
});

const data = await response.json();
document.getElementById('counter').innerText = `NETWORK: ${data.elements.length} UNITS`;

data.elements.forEach((el, index) => {
let coords;

if(el.type === "node"){
coords = [el.lon, el.lat];
}
else if(el.type === "way" && el.center){
coords = [el.center.lon, el.center.lat];
}
else return;

const name = el.tags?.name || "Warehouse Facility";
const facilityId = `warehouse-${index + 1}`;

// Generate realistic data
const power = (Math.random() * 5 + 1).toFixed(1);
const grade = ['A+', 'A', 'B+', 'A-'][Math.floor(Math.random() * 4)];
const utilization = Math.floor(Math.random() * 100);
const hasUGC = ugcDatabase[facilityId] ? true : Math.random() > 0.7;
const verified = Math.random() > 0.8;

// Create marker
const markerEl = document.createElement('div');
markerEl.style.width = '14px';
markerEl.style.height = '14px';
markerEl.style.backgroundColor = hasUGC ? '#ff00ff' : '#00ffea';
markerEl.style.borderRadius = '50%';
markerEl.style.boxShadow = hasUGC ? '0 0 12px #ff00ff' : '0 0 12px #00ffea';
markerEl.style.cursor = 'pointer';
markerEl.style.border = '2px solid black';

const marker = new mapboxgl.Marker({ element: markerEl })
.setLngLat(coords)
.addTo(map);

// Store facility data
marker._facilityData = {
id: facilityId,
name: name,
power: power,
grade: grade,
utilization: utilization,
coords: coords,
hasUGC: hasUGC,
verified: verified,
ugcCount: hasUGC ? Math.floor(Math.random() * 5) + 1 : 0
};

// Click handler
markerEl.addEventListener('click', () => {
openSheet(marker._facilityData);
currentFacility = marker._facilityData;
});

// Popup with TikTok integration
const popupHTML = `
<div style="max-width:280px;">
<h3>${name} ${hasUGC ? '<span class="tiktok-badge">ğŸ“± UGC</span>' : ''}</h3>
<p>ğŸ“¦ Utilization: ${utilization}%</p>
<p>âš¡ Power: ${power} MW</p>
<p>ğŸ† Grade: ${grade}</p>
${hasUGC ? '<p>ğŸ¬ ' + marker._facilityData.ugcCount + ' TikTok clips</p>' : ''}
<hr style="border-color:#333;">
<div style="display:grid; gap:5px;">
<button onclick="window.pinVideoFromPopup('${facilityId}')" style="
width:100%;
padding:8px;
background:#ff00ff;
border:none;
font-weight:bold;
cursor:pointer;
color:white;
border-radius:6px;">
ğŸ“¹ Pin Your TikTok
</button>
<button onclick="window.joinDiscussion('${facilityId}')" style="
width:100%;
padding:8px;
background:#0088cc;
border:none;
font-weight:bold;
cursor:pointer;
color:white;
border-radius:6px;
margin-top:5px;">
ğŸ’¬ Telegram Discussion
</button>
</div>
</div>
`;

const popup = new mapboxgl.Popup({maxWidth:"300px"}).setHTML(popupHTML);
marker.setPopup(popup);

allMarkers.push(marker);
});

} catch (err) {
console.error("Error:", err);
document.getElementById('counter').innerText = "OFFLINE";
}
}

// Filter functions
function filterFacilities(filter) {
document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
event.target.classList.add('active');

allMarkers.forEach(marker => {
const data = marker._facilityData;
if (!data) return;

switch(filter) {
case 'all':
marker.getElement().style.display = 'block';
break;
case 'vacant':
marker.getElement().style.display = data.utilization < 30 ? 'block' : 'none';
break;
case 'verified':
marker.getElement().style.display = data.verified ? 'block' : 'none';
break;
case 'ugc':
marker.getElement().style.display = data.hasUGC ? 'block' : 'none';
break;
}
});
}

// Sheet functions
function openSheet(data) {
document.getElementById('s-name').innerText = data.name;
document.getElementById('s-grade').innerText = data.grade;
document.getElementById('s-power').innerText = data.power + " MW";
document.getElementById('s-zone').innerText = data.utilization > 70 ? "HIGH TRAFFIC" : "NORMAL";
document.getElementById('s-loc').innerText = `Atlanta â€¢ ${data.utilization}% utilized`;

// Show/hide verified badge
const verifiedBadge = document.getElementById('verified-badge');
if (data.verified) {
verifiedBadge.style.display = 'inline-block';
} else {
verifiedBadge.style.display = 'none';
}

// Update UGC count
document.getElementById('ugc-count').innerText = `ğŸ“± ${data.ugcCount || 0} UGC clips`;

// Show UGC preview if available
const ugcPreview = document.getElementById('ugc-preview');
if (data.hasUGC) {
ugcPreview.style.display = 'block';
} else {
ugcPreview.style.display = 'none';
}

document.getElementById('sheet').classList.add('open');
}

function closeSheet() {
document.getElementById('sheet').classList.remove('open');
}

// TikTok AR Functions
function openTikTokAR() {
// Open TikTok with AR effect
window.open('https://tiktok.com/@atlwarehouse?effect=1', '_blank');
}

function pinYourVideo() {
if (!currentFacility) {
alert('Please select a warehouse first');
return;
}

// Open TikTok with pre-filled caption
const caption = encodeURIComponent(`ğŸ“ Pinning this video to ${currentFacility.name} on @atlwarehouse map! #warehouse #atlanta #logistics`);
window.open(`https://tiktok.com/@atlwarehouse?caption=${caption}&effect=123456789`, '_blank');
    
// Track that user is pinning
setTimeout(() => {
alert(`âœ… After posting, DM @atlwarehouse on TikTok or Telegram with your video link to get it pinned!`);
}, 1000);
}

function playUGC(videoId) {
// Open TikTok video
window.open('https://tiktok.com/@atlwarehouse', '_blank');
}

// Telegram Functions
function openTelegram() {
window.open('https://t.me/atlwarehouse', '_blank');
}

function joinTelegramDiscussion() {
if (!currentFacility) {
window.open('https://t.me/atlwarehouse', '_blank');
return;
}

const message = encodeURIComponent(`Discussing ${currentFacility.name} - join the conversation!`);
window.open(`https://t.me/atlwarehouse?start=${currentFacility.id}`, '_blank');
}

// Popup functions (need to be global)
window.pinVideoFromPopup = function(facilityId) {
const facility = allMarkers.find(m => m._facilityData.id === facilityId)?._facilityData;
if (facility) {
currentFacility = facility;
pinYourVideo();
}
};

window.joinDiscussion = function(facilityId) {
const facility = allMarkers.find(m => m._facilityData.id === facilityId)?._facilityData;
if (facility) {
currentFacility = facility;
joinTelegramDiscussion();
}
};

function requestInspection() {
if (!currentFacility) {
alert('Please select a warehouse first');
return;
}

// Send to Telegram
const message = encodeURIComponent(`ğŸ” Inspection requested for ${currentFacility.name} by a user`);
window.open(`https://t.me/atlwarehouse?text=${message}`, '_blank');
    
alert('âœ… Request sent to @atlwarehouse community. Check Telegram for updates!');
closeSheet();
}

// Load warehouses when map is ready
map.on('load', loadWarehouses);

// Check URL for UGC parameter (when someone shares a pinned video)
const urlParams = new URLSearchParams(window.location.search);
const ugcParam = urlParams.get('ugc');
if (ugcParam) {
setTimeout(() => {
alert(`ğŸ¬ Viewing UGC content: ${ugcParam}`);
}, 2000);
}
</script>

</body>
</html>
